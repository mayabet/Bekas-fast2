<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mita Betting - My Account</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Noto+Sans+Ethiopic:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { background: #eef2f7; font-family: 'Noto Sans Ethiopic', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .en-mode { font-family: 'Poppins', sans-serif !important; }
        .card { width: 92%; max-width: 360px; background: white; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,45,75,0.15); overflow: hidden; border: 1px solid #cfe0eb; display: flex; flex-direction: column; }
        .top-bar { background: #002d4b; padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; color: #fff; }
        .top-title { font-weight: 900; font-size: 18px; }
        .header-line { height: 3px; background: #ff8c00; width: 100%; }
        .content { padding: 20px; }
        .input-box { border: 2.5px solid #002d4b; border-radius: 8px; padding: 10px; margin-bottom: 12px; display: flex; align-items: center; background: #fff; }
        .input-box i { color: #002d4b; margin-right: 12px; width: 20px; text-align: center; }
        input { border: none; outline: none; width: 100%; font-size: 16px; font-weight: 600; font-family: inherit; }
        .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: 800; cursor: pointer; margin-bottom: 10px; font-size: 15px; font-family: inherit; }
        .sms-btn { background: #ff8c00; color: white; }
        .save-btn { background: #002d4b; color: white; }
        .back-btn { background: #777; color: white; text-decoration: none; display: block; text-align: center; }
        #msg-box { text-align: center; font-weight: 800; margin-bottom: 10px; font-size: 14px; min-height: 18px; }
    </style>
</head>
<body>

<div class="card">
    <div class="top-bar">
        <span class="top-title" id="txt-title">መለያዬ</span>
        <span style="color:#ff8c00; font-size:24px; font-weight:900;">18+</span>
    </div>
    <div class="header-line"></div>

    <div class="content">
        <div id="msg-box"></div>
        
        <div class="input-box">
            <i class="fas fa-phone"></i>
            <input type="tel" id="p-input" placeholder="የስልክ ቁጥር">
        </div>

        <button class="btn sms-btn" onclick="handleSMS()" id="btn-sms">ሚስጥር ቁጥር በ SMS ላኩልኝ</button>
        
        <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
        
        <div class="input-box">
            <i class="fas fa-key"></i>
            <input type="password" id="old-pass" placeholder="የድሮ ሚስጥር ቁጥር">
        </div>
        <div class="input-box">
            <i class="fas fa-lock"></i>
            <input type="password" id="new-pass" placeholder="አዲስ ሚስጥር ቁጥር">
        </div>
        
        <button class="btn save-btn" onclick="handleSave()" id="btn-save">ቀይር</button>
        <a href="index.html" class="btn back-btn" id="btn-back">ተመለስ</a>
    </div>
</div>

<script>
    // --- Updated Firebase Config ---
    const firebaseConfig = {
        apiKey: "AIzaSyCOrYzcTRXTX50Aqhz4GoVjpptrmh4BKu0",
        authDomain: "bekas-fast2.firebaseapp.com",
        databaseURL: "https://bekas-fast2-default-rtdb.firebaseio.com",
        projectId: "bekas-fast2",
        storageBucket: "bekas-fast2.firebasestorage.app",
        messagingSenderId: "267970590270",
        appId: "1:267970590270:web:dd4adbda56d4e27aaf036f"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    let currentLang = 'am';

    function showMsg(t, c) {
        const b = document.getElementById('msg-box');
        b.innerText = t; b.style.color = c;
        setTimeout(() => b.innerText = "", 3000);
    }

    function handleSMS() {
        const ph = document.getElementById('p-input').value.trim();
        if(ph.length < 10) { 
            showMsg(currentLang === 'am' ? "ትክክለኛ ስልክ ያስገቡ" : "ENTER VALID PHONE", "red"); 
            return; 
        }
        database.ref('password_requests').push({ 
            phone: ph, 
            status: "pending",
            time: new Date().toLocaleString() 
        }).then(() => {
            showMsg(currentLang === 'am' ? "ጥያቄዎ ተልኳል!" : "REQUEST SENT!", "green");
        });
    }

    function handleSave() {
        const ph = document.getElementById('p-input').value.trim();
        const oldP = document.getElementById('old-pass').value.trim();
        const newP = document.getElementById('new-pass').value.trim();
        
        if(!ph || !oldP || !newP) { 
            showMsg(currentLang === 'am' ? "እባክዎ መረጃ ይሙሉ" : "FILL ALL INFO", "red"); 
            return; 
        }

        database.ref('users/' + ph).once('value').then(snap => {
            if(snap.exists() && snap.val().password === oldP) {
                database.ref('users/' + ph).update({ password: newP }).then(() => {
                    showMsg("SUCCESS!", "green");
                    setTimeout(() => window.location.href = "index.html", 1500);
                });
            } else { 
                showMsg(currentLang === 'am' ? "የቆየው ሚስጥር ቁጥር ስህተት ነው" : "WRONG OLD PASSWORD", "red"); 
            }
        });
    }
</script>
</body>
</html>
