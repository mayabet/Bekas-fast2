<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mita Betting - Play 3 (200 Birr)</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <style>
        html, body { margin: 0; padding: 0; background: #eef2f7; font-family: sans-serif; overflow-y: auto; }
        .app-container { width: 100%; max-width: 400px; min-height: 100vh; border: 2.5px solid #002d4b; margin: 0 auto; display: flex; flex-direction: column; background: #fff; box-sizing: border-box; }
        .yellow-banner { background: #002d4b; padding: 12px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3.5px solid #ff8c00; color: white; }
        .game-title { font-weight: 900; font-size: 14px; }
        .plus18 { color: #ff8c00; font-size: 22px; font-weight: 900; }
        .info-bar { display: flex; justify-content: space-between; padding: 10px; background: #f9f9f9; border-bottom: 1px solid #ddd; font-size: 12px; font-weight: 900; color: #002d4b; }
        .main-content { padding: 10px; flex-grow: 1; }
        
        .num-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin-bottom: 15px; }
        .num-cell { height: 50px; background: #fff; border: 2px solid #002d4b; display: flex; justify-content: center; align-items: center; font-weight: 900; font-size: 18px; cursor: pointer; border-radius: 6px; transition: 0.2s; }
        .num-cell.taken-cell { background: #ff4444; color: white; border-color: #ff4444; cursor: not-allowed; }
        .num-cell.user-selected { background: #ff8c00; color: white; border-color: #ff8c00; }
        
        #msg-box { background: #002d4b; color: #fff; padding: 12px; text-align: center; border-radius: 8px; font-weight: 800; font-size: 14px; margin-bottom: 15px; }
        
        .live-view { background: #f0f0f0; border-radius: 10px; padding: 20px; text-align: center; margin-bottom: 15px; border: 2px dashed #002d4b; }
        .circle-display { width: 100px; height: 100px; border-radius: 50%; background: #002d4b; color: white; display: flex; justify-content: center; align-items: center; font-size: 40px; font-weight: 900; margin: 0 auto 10px; border: 4px solid #ff8c00; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        .table-area { width: 100%; border-collapse: collapse; font-size: 13px; font-weight: 800; margin-top: 10px; }
        .table-area th { background: #002d4b; color: white; padding: 8px; text-align: left; }
        .table-area td { border: 1px solid #ddd; padding: 8px; }
        .id-col { width: 40px; text-align: center; background: #eee; }
        
        .footer-btns { padding: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; border-top: 1.5 solid #002d4b; }
        .btn { padding: 12px; border: none; border-radius: 6px; font-weight: 900; font-size: 14px; cursor: pointer; text-align: center; text-decoration: none; }
        .btn-home { background: #777; color: white; }
        .lang-link { color: #002d4b; font-weight: 900; cursor: pointer; font-size: 12px; }
        .lang-link.active { color: #ff8c00; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="yellow-banner">
        <span class="game-title" id="t-game">የ 200 ብር ጨዋታ (30 ሰው)</span>
        <span class="plus18">18+</span>
    </div>

    <div class="info-bar">
        <span id="date-label">DATE: --/--/--</span>
        <span id="time-label">TIME: 00:00:00</span>
    </div>

    <div class="main-content">
        <div id="msg-box">ቁጥር ይምረጡ / SELECT A NUMBER</div>

        <div class="live-view">
            <div class="circle-display" id="live-num">?</div>
            <div style="font-weight: 900; color: #002d4b;" id="t-live">ቀጥታ ውጤት</div>
        </div>

        <div class="num-grid" id="grid-container"></div>

        <table class="table-area">
            <thead>
                <tr>
                    <th id="th-num">ቁጥር</th>
                    <th id="th-name">ተጫዋች</th>
                </tr>
            </thead>
            <tbody id="sel-table"></tbody>
        </table>
    </div>

    <div class="footer-btns">
        <a href="home.html" class="btn btn-home" id="btn-home">ተመለስ</a>
        <div style="display:flex; align-items:center; justify-content:center; gap:5px;">
            <span class="lang-link active" id="l-am" onclick="setLang('am')">አማርኛ</span> | 
            <span class="lang-link" id="l-en" onclick="setLang('en')">EN</span>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCOrYzcTRXTX50Aqhz4GoVjpptrmh4BKu0",
        authDomain: "bekas-fast2.firebaseapp.com",
        databaseURL: "https://bekas-fast2-default-rtdb.firebaseio.com",
        projectId: "bekas-fast2",
        storageBucket: "bekas-fast2.firebasestorage.app",
        messagingSenderId: "267970590270",
        appId: "1:267970590270:web:dd4adbda56d4e27aaf036f"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const userPhone = localStorage.getItem('userPhone');
    let userName = "User";
    let userBalance = 0;
    let currentLang = 'am';

    if (userPhone) {
        database.ref('users/' + userPhone).on('value', snap => {
            const data = snap.val();
            if (data) {
                userName = data.username || "User";
                userBalance = data.balance || 0;
            }
        });
    }

    database.ref('games/game3').on('value', snap => {
        const gameData = snap.val() || {};
        const selections = gameData.selections || {};
        const liveResult = gameData.liveResult || "?";
        
        document.getElementById('live-num').innerText = liveResult;
        renderGrid(selections);
        renderTable(selections);
    });

    function renderGrid(selections) {
        const container = document.getElementById('grid-container');
        container.innerHTML = "";
        for (let i = 1; i <= 30; i++) {
            const cell = document.createElement('div');
            cell.innerText = i;
            cell.className = "num-cell";
            if (selections[i]) {
                cell.classList.add(selections[i] === userName ? "user-selected" : "taken-cell");
            } else {
                cell.onclick = () => selectNumber(i);
            }
            container.appendChild(cell);
        }
    }

    function selectNumber(num) {
        if (!userPhone) return alert("Please Login!");
        if (userBalance < 200) return alert(currentLang === 'am' ? "በቂ ሂሳብ የለዎትም!" : "Insufficient Balance!");

        if (confirm((currentLang === 'am' ? "ቁጥር " : "Select Number ") + num + " (200 Birr)?")) {
            const newBal = userBalance - 200;
            database.ref('users/' + userPhone).update({ balance: newBal });
            database.ref('games/game3/selections/' + num).set(userName);
        }
    }

    function renderTable(selections) {
        const table = document.getElementById('sel-table');
        table.innerHTML = "";
        Object.keys(selections).forEach(num => {
            table.innerHTML += `<tr><td class="id-col">${num}</td><td>${selections[num]}</td></tr>`;
        });
    }

    function setLang(l) {
        currentLang = l;
        const isEn = l === 'en';
        document.getElementById('t-game').innerText = isEn ? "200 BIRR GAME (30 PPL)" : "የ 200 ብር ጨዋታ (30 ሰው)";
        document.getElementById('t-live').innerText = isEn ? "LIVE RESULT" : "ቀጥታ ውጤት";
        document.getElementById('btn-home').innerText = isEn ? "BACK" : "ተመለስ";
        document.getElementById('th-num').innerText = isEn ? "NO." : "ቁጥር";
        document.getElementById('th-name').innerText = isEn ? "PLAYER" : "ተጫዋች";
        document.getElementById('l-am').className = isEn ? 'lang-link' : 'lang-link active';
        document.getElementById('l-en').className = isEn ? 'lang-link active' : 'lang-link';
    }

    setInterval(() => {
        const now = new Date();
        document.getElementById('time-label').innerText = "TIME: " + now.toLocaleTimeString();
        document.getElementById('date-label').innerText = "DATE: " + now.toLocaleDateString();
    }, 1000);
</script>
</body>
</html>
